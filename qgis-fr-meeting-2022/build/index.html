<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>QGIS Server, le choix de la simplicit&#xE9;</title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="hovercraft-qcooperative-theme/css/custom-hov.css" media="screen,projection"></link><link rel="stylesheet" href="hovercraft-qcooperative-theme/css/custom.css" media="screen,projection"></link><link rel="stylesheet" href="custom.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress" data-transition-duration="1500"><div class="step step-level-1" step="0" id="presentation-title" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="qgis-server-le-choix-de-la-simplicite">QGIS Server, le choix de la simplicit&#xE9;(?)</h1><p>Paul Blottiere</p><p>Hytech-Imaging / QCooperative</p><p>18-01-2022</p><img src="images/qgis.png" width="400" class="centered"></img></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="quoi">Quoi?</h1><ul><li>Serveur de cartographie: concepts simplifi&#xE9;s</li><li>QGIS Server: ses atouts sur la simplicit&#xE9; de configuration</li><li>D&#xE9;ploiement: terminologie et exemple "simple" d'une stack compl&#xE8;te</li></ul><img src="images/compass.jpg" width="500" class="centered"></img></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="qui">Qui?</h1><ul><li><dl><dt>Paul Blottiere</dt><dd><ul><li>Lead Dev &#xE0; Hytech Imaging</li><li>D&#xE9;veloppeur QGIS core et server</li><li>Membre de la QCooperative</li></ul></dd></dl></li></ul><img src="images/pblottiere.png" width="200" class="centered"></img><p class="centered"><img src="images/twitter.png" alt="twitter" width="30"></img> <a href="https://twitter.com/pblottiere">@pblottiere</a></p></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="qcooperative">QCooperative</h1><ul><li>Large panel de services SIG</li><li>&#xC9;thique de l'Open Source</li><li>Groupe International</li><li>Membres actifs de la communaut&#xE9; QGIS</li></ul><img src="images/qcooperative.png" width="500" class="centered"></img><p class="centered"><img src="images/twitter.png" alt="twitter" width="30"></img> <a href="https://twitter.com/CooperativeQ">@CooperativeQ</a></p></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="hytech-imaging">Hytech-Imaging</h1><ul><li>Objectif: d&#xE9;velopper les usages de l'imagerie spectrale<ul><li>Services d'acquisition (a&#xE9;roport&#xE9;s, drones, ...)</li><li>Extraction d'informations</li><li>Infra de traitements</li></ul></li></ul><img src="images/hti.jpg" width="400" class="centered"></img><p class="centered"><img src="images/twitter.png" alt="twitter" width="30"></img> <a href="https://twitter.com/HytechImaging">@HytechImaging</a></p></div><div class="step step-level-1" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="serveur-de-cartographie-101">Serveur de cartographie: 101</h1><img src="images/mapserver.png" width="1000" class="centered"></img></div><div class="step step-level-1" step="6" data-transition-duration="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="serveur-de-cartographie-101-1">Serveur de cartographie: 101</h1><img src="images/mapserver_distrib.png" width="1000" class="centered"></img></div><div class="step step-level-1" step="7" data-transition-duration="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><h1 id="serveur-de-cartographie-101-2">Serveur de cartographie: 101</h1><img src="images/mapserver_update.png" width="1000" class="centered"></img></div><div class="step step-level-1" step="8" data-transition-duration="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="serveur-de-cartographie-101-3">Serveur de cartographie: 101</h1><img src="images/mapserver_interop.png" width="1000" class="centered"></img></div><div class="step step-level-1" step="9" data-transition-duration="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><h1 id="serveur-de-cartographie-101-4">Serveur de cartographie: 101</h1><img src="images/mapserver_full.png" width="1000" class="centered"></img></div><div class="step step-level-1" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><h1 id="serveur-de-cartographie-standards-ogc">Serveur de cartographie: standards OGC</h1><ul><li>Standards OGC (Open Geospatial Consortium)<ul><li>WMS / WMTS: retourne une image (PNG, JPG, ...)</li><li>WFS / OGC API Features: retourne du texte (GeoJSON, GML, ...)</li></ul></li></ul><img src="images/wms_wfs.png" width="1000" class="centered"></img></div><div class="step step-level-1" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><h1 id="qgis-server">QGIS Server</h1><ul><li>Un serveur de cartographie<ul><li>qui respecte les standards OGC (certifi&#xE9; WMS)</li><li>bas&#xE9; sur le moteur de rendu de QGIS Desktop</li></ul></li></ul></div><div class="step step-level-1" step="12" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><h1 id="qgis-server-ecosysteme">QGIS Server: &#xE9;cosyst&#xE8;me</h1><ul><li>Ses camarades open-source</li></ul><img src="images/mapservers.png" width="1200" class="centered"></img><ul><li>QGIS Server est-il <em>"mieux"</em>?<ul><li>Non!</li></ul></li><li>QGIS Server est-il <em>"plus simple"</em>?<ul><li>Oui sur certains aspects</li></ul></li></ul></div><div class="step step-level-1" step="13" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20800" data-y="0" data-z="0"><h1 id="qgis-server-wysiwyg">QGIS Server: WYSIWYG</h1><ul><li>Simplicit&#xE9; de configuration<ul><li>WYSIWYG (What You See Is What You Get)</li><li>Le projet .qgs/.qgz est LE fichier de configuration</li></ul></li></ul><img src="images/config.png" width="1200" class="centered"></img></div><div class="step step-level-1" step="14" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="22400" data-y="0" data-z="0"><h1 id="qgis-server-plugins">QGIS Server: Plugins</h1><ul><li>Simplicit&#xE9; de personalisation<ul><li>Plugins Python (PyQGIS)</li><li><a href="https://plugins.qgis.org/plugins/server/">https://plugins.qgis.org/plugins/server/</a></li></ul></li></ul><div class="line-block"><br></br></div><p class="centered"><a href="https://docs.qgis.org/3.16/fr/docs/pyqgis_developer_cookbook/server.html">https://docs.qgis.org/3.16/fr/docs/pyqgis_developer_cookbook/server.html</a></p></div><div class="step step-level-1" step="15" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="24000" data-y="0" data-z="0"><h1 id="qgis-server-extensions">QGIS Server: Extensions</h1><ul><li>De nombreuses extensions aux services et param&#xE8;tres standards OGC</li><li>Exemple: <tt>GetPrint</tt><ul><li>G&#xE9;n&#xE9;ration de rapport (PDF, JPG, ...)</li><li>Bas&#xE9; sur le layout manager de QGIS Desktop (encore du WYSIWYG)</li></ul></li></ul><div class="line-block"><br></br></div><p class="centered">-&gt; <em>pas besoin de composants suppl&#xE9;mentaires</em></p></div><div class="step step-level-1" step="16" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="25600" data-y="0" data-z="0"><h1 id="qgis-server-clients">QGIS Server: clients</h1><ul><li>De nombreuses solutions clientes sur &#xE9;tag&#xE8;re<ul><li>Lizmap</li><li>QWC2</li><li>G3W-Suite</li></ul></li></ul><img src="images/lizmap.jpg" width="1200" class="centered"></img></div><div class="step step-level-1" step="17" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="27200" data-y="0" data-z="0"><h1 id="deploiement">D&#xE9;ploiement</h1><ul><li>Conteneurisation<ul><li>Solution simple de d&#xE9;ploiement</li><li>De nombreuses images Docker disponibles pour QGIS Server</li></ul></li></ul><div class="line-block"><br></br></div><p class="centered"><tt>docker run -p 8010:80 openquake/qgis-server:ltr</tt></p></div><div class="step step-level-1" step="18" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="28800" data-y="0" data-z="0"><h1 id="deploiement-1">D&#xE9;ploiement</h1><ul><li>Orchestration<ul><li>Applications multi-conteneurs / multi-h&#xF4;tes (cluster)</li><li>Maintenance, passage &#xE0; l'&#xE9;chelle (scaling), ...</li><li>Swarm, Kubernetes, ...</li><li>Pour des besoins simples: <tt>docker-compose</tt></li></ul></li></ul></div><div class="step step-level-1" step="19" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="30400" data-y="0" data-z="0"><h1 id="deploiement-2">D&#xE9;ploiement</h1><ul><li>&#xC9;quilibrage de charge<ul><li>Beaucoup de clients -&gt; plusieurs serveurs (scaling)</li><li>Comment distribuer les requ&#xEA;tes aux serveurs innocup&#xE9;s? -&gt; Load-Balancer</li><li>NGINX (Docker image)</li></ul></li></ul><img src="images/loadbalancer.png" width="1000" class="centered"></img></div><div class="step step-level-1" step="20" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="32000" data-y="0" data-z="0"><h1 id="deploiement-3">D&#xE9;ploiement</h1><ul><li>Cache?<ul><li>Ne pas activer le moteur de rendu plusieurs fois pour la m&#xEA;me chose</li><li>WMS: retourne une image sauv&#xE9;e sur le disque</li><li>Map-Proxy (Docker image)</li></ul></li></ul><img src="images/mapproxy.png" width="1000" class="centered"></img></div><div class="step step-level-1" step="21" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="33600" data-y="0" data-z="0"><h1 id="deploiement-4">D&#xE9;ploiement</h1><ul><li>Pour r&#xE9;sumer<ul><li>Composition de conteneurs Dockers avec <tt>docker-compose</tt></li><li>Client -&gt; <tt>MapProxy</tt> (cache) -&gt; <tt>NGINX</tt> (load-balancer) -&gt; N <tt>QGIS Server</tt> (scaling)</li><li>Bac &#xE0; sable de test avec <tt>mviewer</tt> en client web:</li></ul></li></ul><div class="line-block"><br></br></div><p class="centered"><a href="https://github.com/pblottiere/qgis-server-stack">https://github.com/pblottiere/qgis-server-stack</a></p></div><div class="step step-level-1" step="22" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="35200" data-y="0" data-z="0"><h1 id="deploiement-5">D&#xE9;ploiement</h1><ul><li>Configuration insurmontable?<ul><li><tt>docker-compose.yml</tt>: 30 lignes</li><li><tt>mapproxy/mapproxy.yml</tt>: 30 lignes</li><li><tt>nginx-load-balancer.conf</tt>: 15 lignes</li><li><tt>mviewer/default.xml</tt>: 20 lignes</li></ul></li></ul><div class="line-block"><br></br></div><p class="centered"><tt>$ docker-compose up --scale qgisserver=2 -d</tt></p></div><div class="step step-level-1" step="23" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="36800" data-y="0" data-z="0"><h1 id="deploiement-6">D&#xE9;ploiement</h1><ul><li>Scaling: <tt>qgis-server-stack-qgisserver-1</tt> et <tt>qgis-server-stack-qgisserver-2</tt></li><li>Cache: <tt>mapproxy/cache_data/countries_cache_EPSG3857</tt></li></ul><img src="images/mviewer.png" width="1000" class="centered"></img></div><div class="step step-level-1" step="24" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="38400" data-y="0" data-z="0"><h1 id="conclusions">Conclusions</h1><ul><li>Concepts assez palpables<ul><li>QGIS Server: ses atouts pour la simplicit&#xE9; de configuration</li><li>D&#xE9;ploiement de QGIS Server: exemple "simple" d'une stack compl&#xE8;te</li></ul></li><li>Mais pas si simple en production...<ul><li>Si projet complexe (performance en cas de nombreuses couches, ...)</li><li>Si d&#xE9;ploiement/maintenance sur clusters</li></ul></li></ul></div><div class="step step-level-1" step="25" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="40000" data-y="0" data-z="0"><p class="chapter">Merci</p></div></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/gotoSlide.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>